{"ast":null,"code":"import _objectSpread from \"/Users/habitat/Desktop/share-bus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/habitat/Desktop/share-bus/src/page/permission/index.js\";\nimport React from 'react';\nimport { Transfer, Tree, message, Modal, Card, Button, Table, Form, Input, Radio, Select, DatePicker } from 'antd';\nimport axios from \"../../axios\";\nimport Utils from './../../utils/utils';\nimport moment from \"moment\";\nimport data from './../../config/menuConfig';\nimport { dimValueGetter } from \"echarts/src/component/marker/markerHelper\";\nconst FormItem = Form.Item;\nconst Option = Select.Option;\nconst TreeNode = Tree.TreeNode;\nexport default class Permission extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      list: [],\n      selectedRowKeys: '',\n      selectedRowItem: {},\n      showModal: false,\n      isPermissionVisible: false,\n      detailInfo: {},\n      menuInfo: [],\n      isUserVisible: false,\n      mockData: [],\n      targetKeys: []\n    };\n    this.params = {\n      page: 1,\n      params: {}\n    };\n\n    this.requestList = () => {\n      axios.requestList(this, '/role/list', this.params);\n    };\n\n    this.onRowClick = (record, index) => {\n      let selectedRowKeys = [index];\n      this.setState({\n        selectedRowKeys,\n        selectedRowItem: record\n      });\n    };\n\n    this.handleSubmit = () => {\n      let data = this.roleForm.props.form.getFieldsValue();\n      console.log(data);\n      axios.ajax({\n        url: 'role/create',\n        data: {\n          params: data\n        }\n      }).then(res => {\n        // 成功之后首先关闭弹框 然后去重新刷新列表\n        if (res.code == '0') {\n          message.success('创建成功');\n          this.setState({\n            showModal: false\n          }, () => {\n            setTimeout(() => {\n              this.roleForm.props.form.resetFields(); // 关闭弹窗时表单重置\n            }, 500);\n          });\n        }\n\n        this.requestList();\n      });\n    };\n\n    this.handleCreateRole = () => {\n      this.setState({\n        showModal: true\n      });\n    };\n\n    this.handlePermission = () => {\n      let item = this.state.selectedRowItem;\n\n      if (Object.keys(item).length === 0) {\n        Modal.info({\n          title: '提示',\n          content: '请选择一个用户'\n        });\n        return;\n      }\n\n      this.setState({\n        isPermissionVisible: true,\n        detailInfo: item,\n        menuInfo: item.menus\n      });\n    };\n\n    this.handlePermissionSubmit = () => {\n      let data = this.permissionForm.props.form.getFieldsValue();\n      data.role_id = this.state.selectedRowItem.id;\n      data.menus = this.state.menuInfo;\n      axios.ajax({\n        url: '/permission/edit',\n        data: {\n          params: _objectSpread({}, data)\n        }\n      }).then(res => {\n        if (res) {\n          this.setState({\n            isPermissionVisible: false\n          });\n          this.requestList();\n        }\n      });\n    };\n\n    this.handleUserAuth = () => {\n      let item = this.state.selectedRowItem;\n\n      if (Object.keys(item).length === 0) {\n        Modal.info({\n          title: '提示',\n          content: '请选择一个用户'\n        });\n        return;\n      }\n\n      this.setState({\n        isUserVisible: true,\n        detailInfo: item\n      });\n      this.getRoleUserList(item.id);\n    };\n\n    this.getRoleUserList = id => {\n      axios.ajax({\n        url: '/role/user_list',\n        data: {\n          params: {\n            id\n          }\n        }\n      }).then(res => {\n        if (res) {\n          this.getAuthUserList(res.result);\n        }\n      });\n    };\n\n    this.getAuthUserList = data => {\n      const mockData = [];\n      const targetKeys = [];\n      console.log('data');\n      console.log(data);\n\n      if (data && data.length > 0) {\n        for (let i = 0; i < data.length; i++) {\n          let dataObj = {\n            key: data[i].user_id,\n            title: data[i].user_name,\n            status: data[i].status\n          };\n\n          if (data[i].status == 1) {\n            targetKeys.push(dataObj.key);\n          }\n\n          mockData.push(dataObj);\n        }\n\n        this.setState({\n          mockData: mockData,\n          targetKeys: targetKeys\n        });\n      }\n    };\n\n    this.handleUserSubmit = () => {\n      let data = {};\n      data.user_ids = this.state.targetKeys;\n      data.role_id = this.state.selectedRowItem.id;\n      axios.ajax({\n        url: '/role/user_role_edit',\n        data: {\n          params: _objectSpread({}, data)\n        }\n      }).then(res => {\n        if (res) {\n          this.setState({\n            isUserVisible: false\n          });\n        }\n\n        this.requestList();\n      });\n    };\n  }\n\n  componentDidMount() {\n    this.requestList();\n  }\n\n  render() {\n    const columns = [{\n      title: '角色ID',\n      dataIndex: 'id'\n    }, {\n      title: '角色名称',\n      dataIndex: 'role_name'\n    }, {\n      title: '创建时间',\n      dataIndex: 'create_time'\n    }, {\n      title: '角色状态',\n      dataIndex: 'status',\n      render: state => {\n        return {\n          '1': '启用',\n          '0': '停用'\n        }[state];\n      }\n    }, {\n      title: '授权时间',\n      dataIndex: 'authorize_time',\n      render: Utils.formateDate\n    }, {\n      title: '授权人',\n      dataIndex: 'authorize_user_name'\n    }];\n    const _this$state = this.state,\n          list = _this$state.list,\n          selectedRowKeys = _this$state.selectedRowKeys,\n          showModal = _this$state.showModal,\n          isPermissionVisible = _this$state.isPermissionVisible,\n          detailInfo = _this$state.detailInfo,\n          menuInfo = _this$state.menuInfo;\n    const rowSelection = {\n      type: 'radio',\n      selectedRowKeys,\n      onChange: (selectedRowKeys, selectedRows) => {\n        console.log('on change selectedRowKeys');\n        console.log(selectedRowKeys);\n        let ids = [];\n        selectedRows.map(item => {\n          ids.push(item.id);\n        });\n        this.setState({\n          selectedRowKeys // 这个是必须的\n          //  selectedIds: ids, // 附加的\n          //  selectedRows: selectedRows // 多选时 把选中的所有数据存起来 方便管理 onRow 会存单条数据\n\n        });\n      }\n    };\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255\n      },\n      __self: this\n    }, React.createElement(Card, {\n      title: \"\\u6743\\u9650\\u7BA1\\u7406\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }, React.createElement(Button, {\n      type: \"primary\",\n      onClick: this.handleCreateRole,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259\n      },\n      __self: this\n    }, \"\\u521B\\u5EFA\\u89D2\\u8272\"), React.createElement(Button, {\n      type: \"primary\",\n      onClick: this.handlePermission,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260\n      },\n      __self: this\n    }, \"\\u8BBE\\u7F6E\\u6743\\u9650\"), React.createElement(Button, {\n      type: \"primary\",\n      onClick: this.handleUserAuth,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261\n      },\n      __self: this\n    }, \"\\u7528\\u6237\\u6388\\u6743\")), React.createElement(\"div\", {\n      className: \"content-wrap\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263\n      },\n      __self: this\n    }, React.createElement(Table, {\n      columns: columns,\n      dataSource: list,\n      rowSelection: rowSelection,\n      onRow: (record, index) => {\n        return {\n          onClick: () => {\n            // row 当前行被点击之后的回调\n            this.onRowClick(record, index);\n          }\n        };\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264\n      },\n      __self: this\n    })), React.createElement(Modal, {\n      title: \"\\u521B\\u5EFA\\u89D2\\u8272\",\n      visible: showModal,\n      onOk: this.handleSubmit,\n      onCancel: () => {\n        this.roleForm.props.form.resetFields(); // 关闭弹窗时表单重置\n\n        this.setState({\n          showModal: false\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277\n      },\n      __self: this\n    }, React.createElement(CreateRoleForm, {\n      wrappedComponentRef: inst => {\n        this.roleForm = inst;\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286\n      },\n      __self: this\n    })), React.createElement(Modal, {\n      title: \"\\u8BBE\\u7F6E\\u6743\\u9650\",\n      visible: isPermissionVisible,\n      width: 600,\n      onOk: this.handlePermissionSubmit,\n      onCancel: () => {\n        this.setState({\n          isPermissionVisible: false\n        }, () => {\n          this.permissionForm.props.form.resetFields();\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288\n      },\n      __self: this\n    }, React.createElement(PermissionEditForms, {\n      patchMenuInfo: checkedKeys => {\n        this.setState({\n          menuInfo: checkedKeys\n        });\n      },\n      detailInfo: detailInfo,\n      menuInfo: menuInfo,\n      wrappedComponentRef: inst => {\n        this.permissionForm = inst;\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302\n      },\n      __self: this\n    })), React.createElement(Modal, {\n      title: \"\\u7528\\u6237\\u6388\\u6743\",\n      visible: this.state.isUserVisible,\n      width: 800,\n      onOk: this.handleUserSubmit,\n      onCancel: () => {\n        this.setState({\n          isUserVisible: false\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313\n      },\n      __self: this\n    }, React.createElement(RoleAuthForms, {\n      detailInfo: detailInfo,\n      wrappedComponentRef: inst => {\n        this.userAuthForm = inst;\n      },\n      targetKeys: this.state.targetKeys,\n      mockData: this.state.mockData,\n      patchUserInfo: targetKeys => {\n        this.setState({\n          targetKeys\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324\n      },\n      __self: this\n    })));\n  }\n\n}\n\nclass CreateUserForm extends React.Component {\n  render() {\n    const getFieldDecorator = this.props.form.getFieldDecorator;\n    let type = this.props.type;\n    let userInfo = this.props.userInfo || {}; // 如果是水平布局 就需要用到栅格布局\n\n    const formItemLayout = {\n      labelCol: {\n        span: 5\n      },\n      wrapperCol: {\n        span: 15\n      }\n    };\n    return React.createElement(Form, {\n      layout: \"horizontal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353\n      },\n      __self: this\n    }, React.createElement(FormItem, Object.assign({\n      label: \"\\u89D2\\u8272\\u540D\\u79F0\"\n    }, formItemLayout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354\n      },\n      __self: this\n    }), type === 'role_name' ? userInfo.username : getFieldDecorator('role_name', {})(React.createElement(Input, {\n      type: \"text\",\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u89D2\\u8272\\u540D\\u79F0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 359\n      },\n      __self: this\n    }))), React.createElement(FormItem, Object.assign({\n      label: \"\\u72B6\\u6001\"\n    }, formItemLayout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366\n      },\n      __self: this\n    }), type === 'detail' ? userInfo.state : getFieldDecorator('state', {})(React.createElement(Select, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 371\n      },\n      __self: this\n    }, React.createElement(Option, {\n      value: 0,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 372\n      },\n      __self: this\n    }, \"\\u5173\\u95ED\"), React.createElement(Option, {\n      value: 1,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 373\n      },\n      __self: this\n    }, \"\\u5F00\\u542F\")))));\n  }\n\n}\n\nconst CreateRoleForm = Form.create()(CreateUserForm);\n\nclass PermissionEditForm extends React.Component {\n  constructor(...args) {\n    super(...args);\n\n    this.renderTreeNodes = data => {\n      return data.map(item => {\n        if (item.children) {\n          return React.createElement(TreeNode, {\n            title: item.title,\n            key: item.key,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 390\n            },\n            __self: this\n          }, this.renderTreeNodes(item.children));\n        } else {\n          return React.createElement(TreeNode, {\n            title: item.title,\n            key: item.key,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 394\n            },\n            __self: this\n          });\n        }\n      });\n    };\n\n    this.onChenck = checkedKeys => {\n      this.props.patchMenuInfo(checkedKeys);\n    };\n  }\n\n  render() {\n    const getFieldDecorator = this.props.form.getFieldDecorator;\n    const _this$props = this.props,\n          detailInfo = _this$props.detailInfo,\n          menuInfo = _this$props.menuInfo; //263125\n\n    const formItemLayout = {\n      labelCol: {\n        span: 5\n      },\n      wrapperCol: {\n        span: 15\n      }\n    };\n    return React.createElement(Form, {\n      layout: \"horizontal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 411\n      },\n      __self: this\n    }, React.createElement(FormItem, Object.assign({\n      label: \"\\u89D2\\u8272\\u540D\\u79F0\"\n    }, formItemLayout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 412\n      },\n      __self: this\n    }), React.createElement(Input, {\n      placeholder: detailInfo.role_name,\n      disabled: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 413\n      },\n      __self: this\n    })), React.createElement(FormItem, Object.assign({\n      label: \"\\u72B6\\u6001\"\n    }, formItemLayout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 418\n      },\n      __self: this\n    }), getFieldDecorator('status', {\n      initialValue: '0'\n    })(React.createElement(Select, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 423\n      },\n      __self: this\n    }, React.createElement(Option, {\n      value: \"0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 424\n      },\n      __self: this\n    }, \"\\u505C\\u7528\"), React.createElement(Option, {\n      value: \"1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 425\n      },\n      __self: this\n    }, \"\\u542F\\u7528\")))), React.createElement(Tree, {\n      checkable: true,\n      defaultExpandAll: true,\n      onCheck: checkedKeys => {\n        this.onChenck(checkedKeys);\n      },\n      checkedKeys: menuInfo,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 430\n      },\n      __self: this\n    }, React.createElement(TreeNode, {\n      title: \"\\u5E73\\u53F0\\u6743\\u9650\",\n      key: \"permission_all\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 439\n      },\n      __self: this\n    }, this.renderTreeNodes(data))));\n  }\n\n}\n\nconst PermissionEditForms = Form.create()(PermissionEditForm);\n\nclass RoleAuthForm extends React.Component {\n  constructor(...args) {\n    super(...args);\n\n    this.filterOption = (inputValue, option) => option.title.indexOf(inputValue) > -1;\n\n    this.handleChange = targetKeys => {\n      this.props.patchUserInfo(targetKeys);\n    };\n  }\n\n  componentDidMount() {\n    console.log('targetKeys');\n    console.log(this.props.targetKeys);\n  }\n\n  render() {\n    const getFieldDecorator = this.props.form.getFieldDecorator;\n    const _this$props2 = this.props,\n          detailInfo = _this$props2.detailInfo,\n          menuInfo = _this$props2.menuInfo; //263125\n\n    const formItemLayout = {\n      labelCol: {\n        span: 5\n      },\n      wrapperCol: {\n        span: 15\n      }\n    };\n    return React.createElement(Form, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 472\n      },\n      __self: this\n    }, React.createElement(FormItem, Object.assign({\n      label: \"\\u89D2\\u8272\\u540D\\u79F0\"\n    }, formItemLayout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 473\n      },\n      __self: this\n    }), React.createElement(Input, {\n      placeholder: detailInfo.role_name,\n      disabled: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 474\n      },\n      __self: this\n    }), React.createElement(FormItem, {\n      style: {\n        marginTop: 30\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 478\n      },\n      __self: this\n    }, React.createElement(Transfer, {\n      listStyle: {\n        width: 200,\n        height: 400\n      },\n      dataSource: this.props.mockData,\n      targetKeys: this.props.targetKeys,\n      titles: ['待选用户', '已选用户'],\n      showSearch: true,\n      searchPlaceholder: \"\\u8F93\\u5165\\u7528\\u6237\\u540D\",\n      filterOption: this.filterOption,\n      onChange: this.handleChange,\n      render: item => item.title,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 479\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nconst RoleAuthForms = Form.create()(RoleAuthForm);","map":{"version":3,"sources":["/Users/habitat/Desktop/share-bus/src/page/permission/index.js"],"names":["React","Transfer","Tree","message","Modal","Card","Button","Table","Form","Input","Radio","Select","DatePicker","axios","Utils","moment","data","dimValueGetter","FormItem","Item","Option","TreeNode","Permission","Component","state","list","selectedRowKeys","selectedRowItem","showModal","isPermissionVisible","detailInfo","menuInfo","isUserVisible","mockData","targetKeys","params","page","requestList","onRowClick","record","index","setState","handleSubmit","roleForm","props","form","getFieldsValue","console","log","ajax","url","then","res","code","success","setTimeout","resetFields","handleCreateRole","handlePermission","item","Object","keys","length","info","title","content","menus","handlePermissionSubmit","permissionForm","role_id","id","handleUserAuth","getRoleUserList","getAuthUserList","result","i","dataObj","key","user_id","user_name","status","push","handleUserSubmit","user_ids","componentDidMount","render","columns","dataIndex","formateDate","rowSelection","type","onChange","selectedRows","ids","map","onClick","inst","checkedKeys","userAuthForm","CreateUserForm","getFieldDecorator","userInfo","formItemLayout","labelCol","span","wrapperCol","username","CreateRoleForm","create","PermissionEditForm","renderTreeNodes","children","onChenck","patchMenuInfo","role_name","initialValue","PermissionEditForms","RoleAuthForm","filterOption","inputValue","option","indexOf","handleChange","patchUserInfo","marginTop","width","height","RoleAuthForms"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {Transfer ,Tree, message, Modal, Card, Button, Table, Form, Input, Radio, Select, DatePicker} from 'antd'\nimport axios from \"../../axios\"\nimport Utils from './../../utils/utils'\nimport moment from \"moment\"\nimport data from './../../config/menuConfig'\nimport {dimValueGetter} from \"echarts/src/component/marker/markerHelper\"\n\nconst FormItem = Form.Item\nconst Option = Select.Option\nconst { TreeNode } = Tree;\n\nexport default class Permission extends React.Component{\n\n  state = {\n    list: [],\n    selectedRowKeys: '',\n    selectedRowItem: {},\n    showModal: false,\n    isPermissionVisible: false,\n    detailInfo: {},\n    menuInfo: [],\n    isUserVisible: false,\n    mockData: [],\n    targetKeys: []\n  }\n\n  params = {\n    page: 1,\n    params: {}\n  }\n\n  componentDidMount() {\n    this.requestList()\n  }\n\n  requestList = () => {\n    axios.requestList(this, '/role/list', this.params)\n  }\n\n  onRowClick = (record, index) => {\n    let selectedRowKeys = [index]\n    this.setState({\n      selectedRowKeys,\n      selectedRowItem: record\n    })\n  }\n\n  handleSubmit = () => {\n    let data = this.roleForm.props.form.getFieldsValue()\n    console.log(data)\n    axios.ajax({\n      url: 'role/create',\n      data: {\n        params: data\n      }\n    }).then((res) => {\n      // 成功之后首先关闭弹框 然后去重新刷新列表\n      if (res.code == '0') {\n        message.success('创建成功')\n        this.setState({\n          showModal: false\n        }, () => {\n          setTimeout(() => {\n            this.roleForm.props.form.resetFields() // 关闭弹窗时表单重置\n          }, 500)\n        })\n      }\n      this.requestList()\n    })\n\n\n  }\n\n  handleCreateRole = () => {\n    this.setState({\n      showModal: true\n    })\n  }\n\n  // 权限设置\n  handlePermission = () => {\n    let item = this.state.selectedRowItem\n    if (Object.keys(item).length === 0) {\n      Modal.info({\n        title: '提示',\n        content: '请选择一个用户'\n      })\n      return\n    }\n    this.setState({\n      isPermissionVisible: true,\n      detailInfo: item,\n      menuInfo: item.menus\n    })\n  }\n\n  // 权限设置的提交\n  handlePermissionSubmit = () => {\n    let data = this.permissionForm.props.form.getFieldsValue()\n    data.role_id = this.state.selectedRowItem.id\n    data.menus = this.state.menuInfo\n    axios.ajax({\n      url: '/permission/edit',\n      data: {\n        params: {\n          ...data\n        }\n      }\n    }).then((res) => {\n      if (res) {\n        this.setState({\n          isPermissionVisible: false\n        })\n        this.requestList()\n      }\n    })\n  }\n\n  // 用户授权\n  handleUserAuth = () => {\n    let item = this.state.selectedRowItem\n    if (Object.keys(item).length === 0) {\n      Modal.info({\n        title: '提示',\n        content: '请选择一个用户'\n      })\n      return\n    }\n    this.setState({\n      isUserVisible: true,\n      detailInfo: item\n    })\n    this.getRoleUserList(item.id)\n\n  }\n\n  // 通过角色id 获得用户名\n  getRoleUserList = (id) => {\n    axios.ajax({\n      url: '/role/user_list',\n      data: {\n        params: {\n          id\n        }\n      }\n    }).then((res) => {\n      if (res) {\n\n        this.getAuthUserList(res.result)\n      }\n    })\n  }\n\n  // 筛选用户\n  getAuthUserList = (data) => {\n    const mockData = []\n    const targetKeys = []\n    console.log('data')\n    console.log(data)\n    if (data && data.length > 0) {\n      for (let i = 0; i < data.length; i++) {\n        let dataObj = {\n          key: data[i].user_id,\n          title: data[i].user_name,\n          status: data[i].status\n        }\n        if (data[i].status == 1) {\n          targetKeys.push(dataObj.key)\n        }\n        mockData.push(dataObj)\n      }\n      this.setState({\n        mockData: mockData,\n        targetKeys: targetKeys\n      })\n    }\n  }\n\n  // 用户授权表单的提交\n  handleUserSubmit = () => {\n    let data = {}\n    data.user_ids = this.state.targetKeys\n    data.role_id = this.state.selectedRowItem.id\n    axios.ajax({\n      url: '/role/user_role_edit',\n      data: {\n        params: {\n          ...data\n        }\n      }\n    }).then(res => {\n      if (res) {\n        this.setState({\n          isUserVisible: false\n        })\n      }\n      this.requestList()\n    })\n  }\n\n  render() {\n    const columns = [\n      {\n        title: '角色ID',\n        dataIndex: 'id'\n      },\n      {\n        title: '角色名称',\n        dataIndex: 'role_name'\n      },\n      {\n        title: '创建时间',\n        dataIndex: 'create_time',\n      },\n      {\n        title: '角色状态',\n        dataIndex: 'status',\n        render: (state) => {\n          return {\n            '1': '启用',\n            '0': '停用',\n          }[state]\n        }\n      },\n      {\n        title: '授权时间',\n        dataIndex: 'authorize_time',\n        render: Utils.formateDate\n      },\n      {\n        title: '授权人',\n        dataIndex: 'authorize_user_name'\n      }\n    ]\n    const { list, selectedRowKeys, showModal, isPermissionVisible, detailInfo, menuInfo } = this.state\n    const rowSelection = {\n      type: 'radio',\n      selectedRowKeys,\n      onChange: (selectedRowKeys, selectedRows) => {\n        console.log('on change selectedRowKeys')\n        console.log(selectedRowKeys)\n        let ids = []\n        selectedRows.map(item => {\n          ids.push(item.id)\n        })\n        this.setState({\n          selectedRowKeys, // 这个是必须的\n        //  selectedIds: ids, // 附加的\n        //  selectedRows: selectedRows // 多选时 把选中的所有数据存起来 方便管理 onRow 会存单条数据\n        })\n      }\n    }\n    return (\n      <div>\n        <Card\n          title='权限管理'\n        >\n          <Button type='primary' onClick={this.handleCreateRole}>创建角色</Button>\n          <Button type='primary' onClick={this.handlePermission}>设置权限</Button>\n          <Button type='primary' onClick={this.handleUserAuth}>用户授权</Button>\n        </Card>\n        <div className=\"content-wrap\">\n          <Table\n            columns={columns}\n            dataSource={list}\n            rowSelection={rowSelection}\n            onRow={(record, index) => {\n              return {\n                onClick: () => { // row 当前行被点击之后的回调\n                  this.onRowClick(record, index)\n                }\n              }\n            }}\n          />\n        </div>\n        <Modal\n          title='创建角色'\n          visible={showModal}\n          onOk={this.handleSubmit}\n          onCancel={() => {\n            this.roleForm.props.form.resetFields() // 关闭弹窗时表单重置\n            this.setState({showModal: false})}\n          }\n        >\n          <CreateRoleForm wrappedComponentRef={(inst) => {this.roleForm = inst}}/>\n        </Modal>\n        <Modal\n          title='设置权限'\n          visible={isPermissionVisible}\n          width={600}\n          onOk={this.handlePermissionSubmit}\n          onCancel={() => {\n            this.setState({\n              isPermissionVisible: false,\n            }, () => {\n              this.permissionForm.props.form.resetFields()\n            })\n          }}\n\n        >\n          <PermissionEditForms\n            patchMenuInfo={(checkedKeys) => {\n              this.setState({\n                menuInfo: checkedKeys\n              })\n            }}\n            detailInfo={detailInfo}\n            menuInfo={menuInfo}\n            wrappedComponentRef={(inst) => {this.permissionForm = inst}}\n          />\n        </Modal>\n        <Modal\n          title='用户授权'\n          visible={this.state.isUserVisible}\n          width={800}\n          onOk={this.handleUserSubmit}\n          onCancel={() => {\n            this.setState({\n              isUserVisible: false\n            })\n          }}\n        >\n          <RoleAuthForms\n            detailInfo={detailInfo}\n            wrappedComponentRef={(inst) => {this.userAuthForm = inst}}\n            targetKeys={this.state.targetKeys}\n            mockData={this.state.mockData}\n            patchUserInfo={(targetKeys) => {\n              this.setState({\n                targetKeys\n              })\n            }}\n            />\n        </Modal>\n      </div>\n    )\n  }\n}\n\n\nclass CreateUserForm extends React.Component {\n  render() {\n    const { getFieldDecorator } = this.props.form\n    let type = this.props.type\n    let userInfo = this.props.userInfo || {}\n    // 如果是水平布局 就需要用到栅格布局\n    const formItemLayout = {\n      labelCol: {span: 5},\n      wrapperCol: {span: 15}\n    }\n    return (\n      <Form layout='horizontal'>\n        <FormItem label='角色名称' {...formItemLayout}>\n          {\n            type === 'role_name' ? userInfo.username :\n              getFieldDecorator('role_name', {\n              })(\n                <Input\n                  type='text'\n                  placeholder='请输入角色名称'\n                />\n              )\n          }\n        </FormItem>\n        <FormItem label='状态' {...formItemLayout}>\n          {\n            type === 'detail' ? userInfo.state :\n              getFieldDecorator('state', {\n              })(\n                <Select>\n                  <Option value={0}>关闭</Option>\n                  <Option value={1}>开启</Option>\n                </Select>\n              )\n          }\n        </FormItem>\n      </Form>\n    )\n  }\n}\n\nconst CreateRoleForm = Form.create()(CreateUserForm)\n\nclass PermissionEditForm extends React.Component {\n\n  renderTreeNodes = (data) => {\n    return data.map(item => {\n      if (item.children) {\n        return <TreeNode title={item.title} key={item.key}>\n          { this.renderTreeNodes(item.children) }\n        </TreeNode>\n      } else {\n        return <TreeNode title={item.title} key={item.key} />\n      }\n    })\n  }\n\n  onChenck = (checkedKeys) => {\n    this.props.patchMenuInfo(checkedKeys)\n  }\n\n  render() {\n    const { getFieldDecorator } = this.props.form\n    const { detailInfo, menuInfo } = this.props //263125\n    const formItemLayout = {\n      labelCol: {span: 5},\n      wrapperCol: {span: 15}\n    }\n    return (\n      <Form layout='horizontal'>\n        <FormItem label='角色名称' {...formItemLayout} >\n          <Input\n            placeholder={detailInfo.role_name}\n            disabled\n          />\n        </FormItem>\n        <FormItem label='状态' {...formItemLayout} >\n          {\n            getFieldDecorator('status', {\n              initialValue: '0'\n            })(\n              <Select>\n                <Option value='0'>停用</Option>\n                <Option value='1'>启用</Option>\n              </Select>\n            )\n          }\n        </FormItem>\n        <Tree\n          checkable\n          defaultExpandAll\n          onCheck={(checkedKeys) => {\n            this.onChenck(checkedKeys)\n          }}\n          checkedKeys={menuInfo}\n\n        >\n          <TreeNode title='平台权限' key='permission_all'>\n            {\n              this.renderTreeNodes(data)\n            }\n          </TreeNode>\n        </Tree>\n      </Form>\n    )\n  }\n}\nconst PermissionEditForms = Form.create()(PermissionEditForm)\n\nclass RoleAuthForm extends React.Component {\n\n  filterOption = (inputValue, option) => option.title.indexOf(inputValue) > -1;\n\n  componentDidMount() {\n    console.log('targetKeys')\n    console.log(this.props.targetKeys)\n  }\n\n  handleChange = (targetKeys) => {\n    this.props.patchUserInfo(targetKeys)\n  }\n\n  render() {\n    const { getFieldDecorator } = this.props.form\n    const { detailInfo, menuInfo } = this.props //263125\n    const formItemLayout = {\n      labelCol: {span: 5},\n      wrapperCol: {span: 15}\n    }\n    return (\n      <Form>\n        <FormItem label='角色名称' {...formItemLayout} >\n          <Input\n            placeholder={detailInfo.role_name}\n            disabled\n          />\n          <FormItem style={{marginTop: 30}}>\n            <Transfer\n              listStyle={{width: 200, height: 400}}\n              dataSource={this.props.mockData}\n              targetKeys={this.props.targetKeys}\n              titles={['待选用户', '已选用户']}\n              showSearch\n              searchPlaceholder='输入用户名'\n              filterOption={this.filterOption}\n              onChange={this.handleChange}\n              render={(item) => item.title}\n            />\n          </FormItem>\n\n        </FormItem>\n      </Form>\n    )\n  }\n}\n\nconst RoleAuthForms = Form.create()(RoleAuthForm)\n"]},"metadata":{},"sourceType":"module"}